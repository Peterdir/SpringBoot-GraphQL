<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Danh sách sản phẩm (GraphQL + Spring Boot)</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { color: #222; }
        button {
            background-color: #007bff;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background-color: #0056b3; }
        ul { list-style-type: none; padding: 0; margin-top: 10px; }
        li { padding: 6px; border-bottom: 1px solid #ddd; }
    </style>
</head>

<body>
    <h2>Danh sách sản phẩm (tăng dần theo giá)</h2>

    <button id="loadBtn">Tải sản phẩm</button>
    <ul id="productList"></ul>

    <script>
        $("#loadBtn").click(function() {
            const query = `
                query {
                    productsByPriceAsc {
                        productId
                        title
                        price
                    }
                }
            `;

            $.ajax({
                url: '/apis/graphql',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ query: query }),
                success: function(res) {
                    console.log("✅ Kết quả GraphQL:", res);
                    const list = $("#productList");
                    list.empty();

                    const products = res?.data?.productsByPriceAsc ?? [];
                    if (products.length === 0) {
                        list.append("<li>Không có sản phẩm nào.</li>");
                        return;
                    }

                    products.forEach(p => {
                        list.append('<li>' + p.productId + ' - ' + p.title + ' - ' + p.price + ' VNĐ</li>');
                    });
                },
                error: function(err) {
                    console.error("❌ GraphQL lỗi:", err);
                    alert("Đã xảy ra lỗi khi tải dữ liệu!");
                }
            });
        });
    </script>
</body>
</html>
